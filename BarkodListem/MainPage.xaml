<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:BarkodListem.ViewModels"
             xmlns:models="clr-namespace:BarkodListem.Models"
             x:Class="BarkodListem.MainPage"
             x:DataType="{x:Type viewmodels:BarkodListViewModel}"
             Title="Barkod Listesi Oluştur.">

    <ScrollView>
        <VerticalStackLayout Padding="20">

            <!-- Başlık -->
            <Label Text="{Binding AktifListeAdi}" 
                   FontSize="20" 
                   TextColor="Blue" 
                   HorizontalOptions="Center">
                <Label.GestureRecognizers>
                    <TapGestureRecognizer Tapped="ListeAdiniDegistir_Tapped"/>
                </Label.GestureRecognizers>
            </Label>

            <!-- Elle barkod girme kutusu -->
            <Border Stroke="Gray" StrokeThickness="1" Padding="2">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="5"/>
                </Border.StrokeShape>
                <Border.Shadow>
                    <Shadow Brush="Black" Opacity="0.3" />
                </Border.Shadow>
                <Entry x:Name="barkodEntry"
                       Placeholder="Barkodu elle gir..."
                       FontSize="18" 
                       ReturnType="Done"
                       Completed="BarkodEkle_Clicked"/>
            </Border>

            <!-- Butonlar da ScrollView içine alındı -->
            <Grid ColumnDefinitions="*,*"
                  RowDefinitions="Auto,Auto,Auto,Auto"
                  Margin="0,10,0,10"
                  RowSpacing="1"
                  ColumnSpacing="1"
                  BackgroundColor="LightGray">

                <Button Text="BARKOD OKUT"
                        Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="2"
                        Clicked="QRKodTara_Clicked"
                        TextColor="Black"
                        CornerRadius="0" 
                        ImageSource="barkodoku.png"
                        ContentLayout="Top,10" BackgroundColor="#F0F0F0"/>

                <Button Text="BARKOD KAYDET"
                        Grid.Row="1" Grid.Column="0"
                        Clicked="BarkodEntry_Completed"
                        TextColor="Black"
                        CornerRadius="0"
                        ImageSource="save1.png"
                        ContentLayout="Top,10" BackgroundColor="#F0F0F0"/>

                <Button Text="LİSTEYİ GÖNDER"
                        Grid.Row="1" Grid.Column="1"
                        Clicked="ListeyiGonder_Clicked"
                        TextColor="Black"
                        CornerRadius="0"
                        ImageSource="webservis1.png"
                        ContentLayout="Top,10" BackgroundColor="#F0F0F0"/>

                <Button Text="LİSTEYİ TEMİZLE"
                        Grid.Row="2" Grid.Column="0"
                        Clicked="ClearListButton_Clicked"
                        TextColor="Black"
                        CornerRadius="0" 
                        ImageSource="listesil.png"
                        ContentLayout="Top,10" BackgroundColor="#F0F0F0"/>

                <Button Text="AYARLAR"
                        Grid.Row="2" Grid.Column="1"
                        Clicked="Ayarlar_Clicked"
                        TextColor="Black"
                        CornerRadius="0" 
                        ImageSource="ayarlar.png"
                        ContentLayout="Top,10" BackgroundColor="#F0F0F0"/>

                <Button Text="LİSTELER"
                        Grid.Row="3" Grid.Column="0" Grid.ColumnSpan="2"
                        Clicked="Listeler_Clicked"
                        TextColor="Black"
                        ImageSource="qrlistesi.png"
                        ContentLayout="Top,10"
                        CornerRadius="0" BackgroundColor="#F0F0F0"/>
            </Grid>

            <!-- Okunan/eklenen barkodların listesi büyütüldü -->
            <CollectionView x:Name="barkodListesi"
                ItemsSource="{Binding Barkodlar}"
                Margin="0,10,0,0"
                VerticalOptions="Fill">
                <!-- FillAndExpand yerine Fill kullandık -->
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="models:BarkodModel">
                        <Border Background="LightGray" 
                    Stroke="Gray"
                    StrokeThickness="1"
                    Padding="10"
                    Margin="5">
                            <Border.StrokeShape>
                                <RoundRectangle CornerRadius="5"/>
                            </Border.StrokeShape>
                            <Grid ColumnDefinitions="*, Auto">
                                <Label Text="{Binding Barkod}"
                           FontSize="16"
                           VerticalOptions="Center"
                           Grid.Column="0" />
                                <Button Text="Sil"
                            FontSize="14"
                            BackgroundColor="Red"
                            TextColor="White"
                            CornerRadius="0"
                            Clicked="BarkodSilCommand"
                            CommandParameter="{Binding}"
                            Grid.Column="1" />
                            </Grid>
                        </Border>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>


        </VerticalStackLayout>
    </ScrollView>

</ContentPage>
